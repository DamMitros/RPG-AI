<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Erik's Wares - Stonehaven</title>
	<style>
		body {
			font-family: 'Georgia', serif;
			background: linear-gradient(135deg, #2f4f4f, #556b2f);
			color: #f5f5dc;
			margin: 0;
			padding: 20px;
			min-height: 100vh;
		}
		
		.container {
			max-width: 1000px;
			margin: 0 auto;
			background: rgba(47, 79, 79, 0.9);
			border: 3px solid #696969;
			border-radius: 15px;
			padding: 30px;
			box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
		}
		
		h1 {
			text-align: center;
			color: #ffd700;
			font-size: 2.5em;
			text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
			margin-bottom: 10px;
		}
		
		.merchant-intro {
			text-align: center;
			font-style: italic;
			color: #f5f5dc;
			margin: 20px 0;
			font-size: 1.1em;
			background: rgba(85, 107, 47, 0.6);
			padding: 15px;
			border-radius: 8px;
			border-left: 4px solid #ffd700;
		}
		
		.player-gold {
			text-align: center;
			background: rgba(105, 105, 105, 0.6);
			padding: 10px;
			border-radius: 5px;
			margin: 15px 0;
			font-weight: bold;
			color: #ffd700;
		}
		
		.inventory-section { 
			margin: 30px 0; 
			border: 2px solid #696969; 
			padding: 20px; 
			background: rgba(85, 107, 47, 0.3);
			border-radius: 10px;
		}
		
		.inventory-section h2 { 
			margin-top: 0; 
			color: #98fb98;
			text-align: center;
			font-size: 1.5em;
		}
		
		.item { 
			border-bottom: 1px dashed #696969; 
			padding: 15px 0; 
			margin-bottom: 10px;
			background: rgba(47, 79, 79, 0.4);
			padding: 15px;
			border-radius: 5px;
		}
		
		.item:last-child { 
			border-bottom: none; 
		}
		
		.item strong {
			color: #ffd700;
			font-size: 1.1em;
		}
		
		.item em {
			color: #d3d3d3;
			display: block;
			margin: 8px 0;
		}
		
		.shop-message { 
			color: #90ee90; 
			font-weight: bold; 
			margin: 15px 0; 
			background: rgba(0, 100, 0, 0.2);
			padding: 10px;
			border-radius: 5px;
			border: 1px solid #90ee90;
			text-align: center;
		}
		
		.error-message { 
			color: #ff6347; 
			font-weight: bold; 
			margin: 15px 0;
			background: rgba(255, 0, 0, 0.2);
			padding: 10px;
			border-radius: 5px;
			border: 1px solid #ff6347;
			text-align: center;
		} 
		
		button {
			background: linear-gradient(45deg, #228b22, #32cd32);
			color: white;
			border: none;
			padding: 8px 15px;
			border-radius: 5px;
			cursor: pointer;
			font-size: 0.9em;
			margin-left: 10px;
			transition: all 0.3s ease;
		}
		
		button:hover:not(:disabled) {
			background: linear-gradient(45deg, #32cd32, #7fff00);
			transform: translateY(-1px);
			box-shadow: 0 3px 6px rgba(50, 205, 50, 0.3);
		}
		
		button:disabled {
			background: #696969;
			cursor: not-allowed;
			opacity: 0.6;
		}
		
		#conversation {
			height: 250px;
			overflow-y: auto;
			border: 2px solid #696969;
			background: rgba(47, 79, 79, 0.8);
			margin: 15px 0;
			padding: 15px;
			border-radius: 8px;
			box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
		}
		
		#conversation p {
			margin: 8px 0;
			line-height: 1.4;
		}
		
		#conversation strong {
			color: #ffd700;
		}
		
		#conversation hr {
			border: 0;
			height: 1px;
			background: linear-gradient(to right, transparent, #696969, transparent);
			margin: 10px 0;
		}
		
		.conversation-input {
			background: rgba(85, 107, 47, 0.6);
			padding: 15px;
			border-radius: 8px;
			margin: 15px 0;
		}
		
		input[type="text"] {
			background: rgba(47, 79, 79, 0.9);
			border: 2px solid #696969;
			border-radius: 5px;
			color: #f5f5dc;
			padding: 10px;
			font-size: 1em;
		}
		
		input[type="text"]:focus {
			border-color: #ffd700;
			outline: none;
			box-shadow: 0 0 5px rgba(255, 215, 0, 0.3);
		}
		
		label {
			color: #f5f5dc;
			font-weight: bold;
			margin-bottom: 8px;
			display: block;
		}
		
		.return-link {
			text-align: center;
			margin-top: 30px;
		}
		
		.return-link a {
			color: #90ee90;
			text-decoration: none;
			font-size: 1.1em;
			transition: color 0.3s ease;
			padding: 10px 20px;
			border: 1px solid #696969;
			border-radius: 5px;
			background: rgba(85, 107, 47, 0.6);
		}
		
		.return-link a:hover {
			color: #ffd700;
			border-color: #ffd700;
		}
		
		.erik-warning {
			background: rgba(255, 140, 0, 0.1);
			border: 1px solid #ff8c00;
			padding: 12px;
			margin: 15px 0;
			border-radius: 5px;
			color: #f5f5dc;
			text-align: center;
			font-style: italic;
			font-size: 0.9em;
		}
		
		.quest-updates, .quest-actions {
			background: linear-gradient(145deg, rgba(13, 69, 19, 0.7), rgba(34, 139, 34, 0.5));
			border: 2px solid #228b22;
			border-radius: 15px;
			padding: 20px;
			margin: 25px 0;
			box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.4);
		}
		
		.quest-updates h3, .quest-actions h3 {
			color: #90ee90;
			font-family: Georgia, serif;
			margin-bottom: 15px;
			text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
			text-align: center;
		}
		
		.quest-update {
			background: rgba(0, 100, 0, 0.3);
			border: 1px solid #32cd32;
			border-radius: 8px;
			padding: 15px;
			margin: 10px 0;
			font-size: 0.95em;
			text-align: center;
		}
		
		.quest-button {
			background: linear-gradient(145deg, #228b22, #32cd32, #228b22);
			border: 2px solid #90ee90;
			color: #f0fff0;
			padding: 10px 18px;
			border-radius: 8px;
			cursor: pointer;
			font-family: Georgia, serif;
			font-weight: 600;
			font-size: 0.9em;
			text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
			transition: all 0.3s ease;
			margin: 8px;
			display: inline-block;
		}
		
		.quest-button:hover {
			background: linear-gradient(145deg, #32cd32, #90ee90, #32cd32);
			transform: translateY(-2px);
			box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5);
		}
	</style>
</head>
<body>
	<div class="container">
		<h1>üõí Erik's Wares</h1>
		
		<div class="merchant-intro">
			Erik the Wanderer stands beside his cart of mysterious goods.<br>
			His eyes have an unsettling gleam that wasn't there before his last journey to the city...
		</div>
		
		<div class="player-gold">
			Welcome, {{player.name}} | Gold: {{player.gold}} coins
		</div>
		
		<div class="erik-warning">
			Erik whispers: "I've got special items from distant lands... some say they're cursed, but I say they're just... unique."
		</div>

		<!-- Display Shop Messages -->
		{% if shop_message %}
			<div class="shop-message">{{ shop_message }}</div>
		{% endif %}

		<!-- Merchant Wares -->
		<div class="inventory-section">
			<h2>üéí Erik's Strange Wares</h2>
			{% if merchant_wares %}
				{% for item in merchant_wares %}
				<div class="item">
					<strong>{{ item.name }}</strong> - {{ item.price }} Gold ({{ item.quantity }} in stock)<br>
					<em>{{ item.description }}</em>
					<form method="POST" action="{{ url_for('shop') }}" style="display: inline; margin-left: 10px;">
						<input type="hidden" name="action" value="buy">
						<input type="hidden" name="item_id" value="{{ item.id }}">
						<button type="submit" {% if player.gold < item.price %}disabled title="Not enough gold"{% endif %}>
							{% if player.gold < item.price %}Cannot Afford{% else %}Buy{% endif %}
						</button>
					</form>
				</div>
				{% endfor %}
			{% else %}
				<p style="text-align: center; color: #d3d3d3; font-style: italic;">Erik's cart seems emptier than usual today...</p>
			{% endif %}
		</div>

		<!-- Player Inventory -->
		<div class="inventory-section">
			<h2>üí∞ Your Items to Sell</h2>
			{% if player_inventory %}
				{% for item in player_inventory %}
				<div class="item">
					<strong>{{ item.name }}</strong> - Sell for {{ item.sell_value | default(1) }} Gold<br>
					<em>{{ item.description }}</em>
					<form method="POST" action="{{ url_for('shop') }}" style="display: inline; margin-left: 10px;">
						<input type="hidden" name="action" value="sell">
						<input type="hidden" name="item_id" value="{{ item.id }}">
						<button type="submit">Sell</button>
					</form>
				</div>
				{% endfor %}
			{% else %}
				<p style="text-align: center; color: #d3d3d3; font-style: italic;">Your pockets are empty.</p>
			{% endif %}
		</div>

		<!-- Conversation -->
		<div class="inventory-section">
			<h2>üí¨ Speak with Erik</h2>
			<p style="text-align: center; font-style: italic; color: #d3d3d3;">
				"Looking for something particular? I have... special connections in the city..."
			</p>
			
			<div id="conversation">
				{% if history %}
				  {% for turn in history %}
					<p><strong>You:</strong> {{ turn.user }}</p>
					<p><strong>Erik:</strong> {{ turn.npc }}</p>
					<hr>
				  {% endfor %}
				{% else %}
					<p><i>Erik adjusts some mysterious trinkets on his cart and gives you a knowing look...</i></p>
				{% endif %}
			</div>

			<!-- Quest Updates -->
			{% if quest_updates %}
			  <div class="quest-updates">
				<h3>üèÜ Quest Updates:</h3>
				{% for update in quest_updates %}
				  <div class="quest-update">
					<strong>{{ update.quest_title }}</strong><br>
					‚úÖ {{ update.action }} completed!
					{% if update.quest_completed %}
					  <br>üéâ <strong>Quest Completed!</strong>
					  {% if update.rewards %}
						<br>üí∞ Received: {{ update.rewards.gold }} gold, {{ update.rewards.exp }} experience
					  {% endif %}
					{% endif %}
				  </div>
				{% endfor %}
			  </div>
			{% endif %}

			<!-- Available Quest Actions -->
			{% if available_actions %}
			  <div class="quest-actions">
				<h3>üìã Available Quest Actions:</h3>
				{% for action in available_actions %}
				  <form method="POST" action="{{ url_for('shop') }}" style="display: inline-block; margin: 10px;">
					<input type="hidden" name="action" value="quest_action">
					<input type="hidden" name="quest_action" value="{{ action.action }}">
					<button type="submit" class="quest-button">
					  üéØ {{ action.description }} ({{ action.quest_title }})
					</button>
				  </form>
				{% endfor %}
			  </div>
			{% endif %}

			<div class="conversation-input">
				<form method="POST" action="{{ url_for('shop') }}">
					<input type="hidden" name="action" value="talk"> 
					<label for="message">What do you say to Erik?</label>
					<input type="text" id="message" name="message" required autocomplete="off" style="width: calc(100% - 120px);" placeholder="Ask about his goods, the city, or recent travels...">
					<button type="submit">Speak</button>
				</form>
			</div>
		</div>

		<div class="return-link">
			<a href="{{ url_for('mainPage') }}">‚¨ÖÔ∏è Leave Erik's cart (return to village)</a>
		</div>
	</div>
</body>
</html>